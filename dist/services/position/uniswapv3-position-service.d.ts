import { PrismaClient } from "@prisma/client";
import type { UniswapV3PositionConfig, UniswapV3PositionState, UniswapV3Position } from "@midcurve/shared";
import type { UniswapV3PositionDiscoverInput, CreatePositionInput } from "../types/position/position-input.js";
import { PositionService } from "./position-service.js";
import { EvmConfig } from "../../config/evm.js";
import { UniswapV3PoolService } from "../pool/uniswapv3-pool-service.js";
import { EtherscanClient } from "../../clients/etherscan/index.js";
import { UniswapV3PositionLedgerService } from "../position-ledger/uniswapv3-position-ledger-service.js";
import { UniswapV3QuoteTokenService } from "../quote-token/uniswapv3-quote-token-service.js";
import { EvmBlockService } from "../block/evm-block-service.js";
import { PositionAprService } from "../position-apr/position-apr-service.js";
import { UniswapV3PoolPriceService } from "../pool-price/uniswapv3-pool-price-service.js";
export interface UniswapV3PositionServiceDependencies {
    prisma?: PrismaClient;
    evmConfig?: EvmConfig;
    poolService?: UniswapV3PoolService;
    etherscanClient?: EtherscanClient;
    ledgerService?: import("../position-ledger/uniswapv3-position-ledger-service.js").UniswapV3PositionLedgerService;
    quoteTokenService?: UniswapV3QuoteTokenService;
    evmBlockService?: EvmBlockService;
    aprService?: PositionAprService;
    poolPriceService?: UniswapV3PoolPriceService;
}
export declare class UniswapV3PositionService extends PositionService<"uniswapv3"> {
    private readonly _evmConfig;
    private readonly _poolService;
    private readonly _etherscanClient;
    private readonly _ledgerService;
    private readonly _quoteTokenService;
    private readonly _evmBlockService;
    private readonly _aprService;
    private readonly _poolPriceService;
    constructor(dependencies?: UniswapV3PositionServiceDependencies);
    protected get evmConfig(): EvmConfig;
    protected get poolService(): UniswapV3PoolService;
    protected get etherscanClient(): EtherscanClient;
    protected get ledgerService(): UniswapV3PositionLedgerService;
    protected get quoteTokenService(): UniswapV3QuoteTokenService;
    protected get evmBlockService(): EvmBlockService;
    protected get aprService(): PositionAprService;
    protected get poolPriceService(): UniswapV3PoolPriceService;
    parseConfig(configDB: unknown): UniswapV3PositionConfig;
    serializeConfig(config: UniswapV3PositionConfig): unknown;
    parseState(stateDB: unknown): UniswapV3PositionState;
    serializeState(state: UniswapV3PositionState): unknown;
    createPositionHash(config: UniswapV3PositionConfig): string;
    discover(userId: string, params: UniswapV3PositionDiscoverInput): Promise<UniswapV3Position>;
    private computePoolAddress;
    refresh(id: string): Promise<UniswapV3Position>;
    reset(id: string): Promise<UniswapV3Position>;
    createPositionFromUserData(userId: string, chainId: number, nftId: number, input: {
        poolAddress: string;
        tickUpper: number;
        tickLower: number;
        ownerAddress: string;
        quoteTokenAddress?: string;
        increaseEvent: {
            timestamp: Date;
            blockNumber: bigint;
            transactionIndex: number;
            logIndex: number;
            transactionHash: string;
            liquidity: bigint;
            amount0: bigint;
            amount1: bigint;
        };
    }): Promise<UniswapV3Position>;
    updatePositionWithEvents(userId: string, chainId: number, nftId: number, events: Array<{
        eventType: "INCREASE_LIQUIDITY" | "DECREASE_LIQUIDITY" | "COLLECT";
        timestamp: Date;
        blockNumber: bigint;
        transactionIndex: number;
        logIndex: number;
        transactionHash: string;
        tokenId: bigint;
        liquidity?: bigint;
        amount0: bigint;
        amount1: bigint;
        recipient?: string;
    }>): Promise<UniswapV3Position | null>;
    create(input: CreatePositionInput<"uniswapv3">): Promise<UniswapV3Position>;
    findById(id: string): Promise<UniswapV3Position | null>;
    delete(id: string): Promise<void>;
    private getLedgerSummary;
    private calculateUnclaimedFees;
    private calculateCurrentPositionValue;
    private calculatePriceRange;
    private updatePositionCommonFields;
    getCurrentLiquidityFromLedger(positionId: string): Promise<bigint>;
    getPositionCloseTimestamp(positionId: string): Promise<Date | null>;
}
//# sourceMappingURL=uniswapv3-position-service.d.ts.map